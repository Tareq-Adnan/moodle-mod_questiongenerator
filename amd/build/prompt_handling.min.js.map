{"version":3,"file":"prompt_handling.min.js","sources":["../src/prompt_handling.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module prompt_handling\n *\n * @module     mod_questiongenerator/prompt_handling\n * @copyright  2024 YOUR NAME <your@email.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport { call as getContent } from \"core/ajax\";\nimport promptModal from './prompt_modal';\nexport const promptHandling = async (cmid) => {\n\n    var form = $('#prompt-form');\n    var content = $('#mod-qg-body');\n    var spinner = $('#qg-spinner');\n    var save = $('#save-question');\n    var nextStep = $('#next-step');\n    var tryagain = $('#try-again');\n    var modal = $('#bsmodal');\n    var questionData = null;\n    var saveCategory = $('#save-category');\n    form.on('submit', function (e) {\n        e.preventDefault();\n        let formdata = new FormData(this);\n        let prompt = formdata.get('prompt');\n        form.trigger('reset');\n        spinner.show();\n        $(this).find('button[type=\"submit\"]').prop('disabled', true);\n        // promptModal.create({});\n\n\n        getContent([{\n            methodname: 'mod_questiongenerator_submit_prompts',\n            args: { prompt: prompt },\n        }])[0].done(response => {\n            let questions = JSON.parse(response);\n            // console.log(questions);\n            questionData = response;\n            showQuestions(questions);\n            spinner.hide();\n            $(this).find('button[type=\"submit\"]').prop('disabled', false);\n        }).fail(error => {\n            spinner.hide();\n            throw new Error(error.message);\n        });\n    });\n\n    $(document).on('click', '#next-step', function () {\n        $(this).prop('disabled', true); // Disable the button to prevent multiple clicks\n        content.empty(); // Clear the content\n        // $(this).attr('id','savecat-question');\n        if (questionData) {\n            console.log(questionData);\n\n            getContent([{\n                methodname: 'mod_questiongenerator_get_questions_categories',\n                args: {\n                    'cmid': cmid\n                },\n            }])[0].done(response => {\n                $(this).prop('disabled', false); // Re-enable the button after response\n\n                // Check if the response has categories\n                if (response && response.length > 0) {\n                    renderCategorySelect(response);\n                } else {\n                    renderCategoryInput(); // If no categories, show input field\n                }\n            }).fail(error => {\n                spinner.hide();\n                console.error('Error:', error.message);\n                $(this).prop('disabled', false); // Re-enable the button in case of error\n            });\n        }\n    });\n    $(document).on('click', '#save-category', function () {\n        $(this).prop('disabled', true); // Disable the button to prevent multiple clicks\n        // $(this).attr('id','savecat-question');\n        let categoryValue = $('#category').val();\n        content.empty(); // Clear the content\n\n        console.log(categoryValue);\n        if (questionData) {\n            getContent([{\n                methodname: 'mod_questiongenerator_create_question_category',\n                args: {\n                    'cmid': cmid,\n                    'categoryname': categoryValue\n                },\n            }])[0].done(response => {\n                $(this).prop('disabled', false); // Re-enable the button after response\n                console.log(response);\n                console.log(questionData);\n\n                if (response.status) {\n                    getContent([{\n                        methodname: 'mod_questiongenerator_get_questions_categories',\n                        args: {\n                            'cmid':cmid\n\n                        },\n                    }])[0].done(response => {\n                        $(this).prop('disabled', false); // Re-enable the button after response\n\n                        // Check if the response has categories\n                        if (response && response.length > 0) {\n                            renderCategorySelect(response);\n                        } else {\n                            renderCategoryInput(); // If no categories, show input field\n                        }\n                    }).fail(error => {\n                        spinner.hide();\n                        console.error('Error:', error.message);\n                        $(this).prop('disabled', false); // Re-enable the button in case of error\n                    });\n                } else {\n                    renderCategoryInput(); // If no categories, show input field\n                }\n                // Check if the response has categories\n\n            }).fail(error => {\n                spinner.hide();\n                console.error('Error:', error.message);\n                $(this).prop('disabled', false); // Re-enable the button in case of error\n            });\n        }\n    });\n    $(document).on('click', '#save-question', function () {\n        let $this = $(this);\n        $this.prop('disabled', true); // Disable the button to prevent multiple clicks\n        \n        let categoryValue = $('#category').val();\n        console.log(categoryValue);\n    \n        content.empty(); // Clear the content\n    \n        // Show saving animation\n        let savingAnimation = $('<div class=\"saving-animation\">Saving...</div>');\n        content.append(savingAnimation);\n    \n        if (questionData) {\n\n            \n            // Check if correct_answer is an array\n\n            \n            // If you need to convert it back to a JSON string\n            var questionDataJson = JSON.parse(questionData);\n                // Loop through each question object\n            questionDataJson.forEach(function(question) {\n                // Check if correct_answer is an array for each question\n                if (Array.isArray(question.correct_answer)) {\n                    // Convert the array to a single value (e.g., the first element)\n                    question.correct_answer = question.correct_answer[0];\n                }\n            });\n            getContent([{\n                methodname: 'mod_questiongenerator_save_generated_questions',\n                args: {\n                    'cmid': cmid,\n                    'categoryid': categoryValue,\n                    'questionData': questionDataJson\n                },\n            }])[0].done(response => {\n                $this.prop('disabled', false); // Re-enable the button after response\n                console.log(response);\n    \n                // Remove saving animation and show success icon\n                savingAnimation.remove();\n                let successIcon = $('<div class=\"success-icon\">✔️ Saved</div>');\n                content.html(successIcon);\n    \n            }).fail(error => {\n                spinner.hide();\n                console.error('Error:', error.message);\n                \n                // Remove saving animation\n                savingAnimation.remove();\n                $this.prop('disabled', false); // Re-enable the button in case of error\n            });\n        }\n    \n        // Remove modal footer\n        $('.modal-footer').remove();\n    });\n    \n    // $(document).on('click', '.save-btn', function (e) {\n    //    e.preventDefault();\n    //    let category = $('#category').val();\n    //    console.log(val);\n    // })\n\n\n    // Function to render category select dropdown with Bootstrap styling\n    function renderCategorySelect(categories) {\n        let selectHTML = `<div class=\"form-group\">\n                            <label for=\"category\">Select Category:</label>\n                            <select id=\"category\" class=\"form-control\" name=\"category\">`;\n\n        // Populate the select options\n        categories.forEach(category => {\n            selectHTML += `<option value=\"${category.id}\">${category.name}</option>`;\n        });\n\n        selectHTML += `</select>\n                       </div>\n                       <button id=\"createNewCategoryBtn\" type=\"button\" class=\"btn btn-outline-primary mt-2\">Create New Category</button>`;\n\n        content.html(selectHTML); // Render the dropdown into the content variable\n        console.log($('#next-step'));\n        $('#next-step').text('Save Questions');\n        $('#next-step').attr('id', 'save-question');\n        $('#save-category').text('Save Questions');\n        $('#save-category').attr('id', 'save-question');\n        // Add event listener for \"Create New Category\" button\n        $('#createNewCategoryBtn').on('click', function () {\n            renderCategoryInput(); // Switch to input text field\n        });\n    }\n\n    // Function to render category input text field with Bootstrap styling\n    function renderCategoryInput() {\n        const inputHTML = `<div class=\"form-group\">\n                             <label for=\"category\">New Category:</label>\n                             <input type=\"text\" id=\"category\" class=\"form-control\" name=\"category\" placeholder=\"Enter new category\">\n                           </div>\n                           <button id=\"backToSelectBtn\" type=\"button\" class=\"btn btn-outline-secondary mt-2\">Back to Select</button>`;\n\n        content.html(inputHTML); // Render the input field into the content variable\n        $('#save-question').text('Create Category');\n        $('#save-question').attr('id', 'save-category');\n\n        $('#next-step').text('Create Category');\n        $('#next-step').attr('id', 'save-category');\n        // Add event listener for \"Back to Select\" button\n        $('#backToSelectBtn').on('click', function () {\n            // Call the API again or restore previous categories if needed\n            getContent([{\n                methodname: 'mod_questiongenerator_get_questions_categories',\n                args: {\n                    'cmid':cmid\n                },\n            }])[0].done(response => {\n                renderCategorySelect(response);\n            });\n        });\n    }\n\n    $(document).on('click', '#mod-qg-close', function () {\n        hideModal();\n    });\n\n    tryagain.on('click', function () {\n        hideModal();\n    });\n\n    function showQuestions(questions) {\n        let html = '';\n        questions.forEach(question => {\n            html += ` <div class=\"quiz-container\"><div class=\"question\">\n                        <h6>${question.question}</h6>\n                        </div>\n                          <div class=\"options\">\n                        `;\n            question.options.forEach((option, index) => {\n                html += `<label class=\"option\">\n                       \n                        <span><strong>${index + 1}.</strong>  ${option}</span>\n                    </label>`;\n            });\n\n            html += `</div><div id=\"result\" class=\"result\">\n                    <p>The correct answer is: <span id=\"correctAnswer\">${question.correct_answer}</span></p>\n                    </div>`;\n            html += '</div></div>';\n        });\n\n        content.empty().html(html);\n        modal.modal('show');\n    }\n    function hideModal() {\n        modal.addClass('hide');\n        setTimeout(() => {\n            modal.modal('hide').removeClass('hide');\n        }, 250);\n    }\n\n    $(document).on('click', '#attemptquiz', startAttempt);\n    function startAttempt(e) {\n        e.preventDefault();\n    \n        getContent([{\n            methodname: 'mod_questiongenerator_attempt_quiz',\n            args: { cmid: cmid,status:'start' },\n        }])[0].done(response => {\n          if(response.status) {\n            window.location.href = `attempt.php?id=${cmid}`;\n          }\n        }).fail(error => {\n            throw new Error(error.message);\n        });\n    }\n};\n\n"],"names":["_interopRequireDefault","obj","__esModule","default","_jquery","_prompt_modal","_exports","promptHandling","async","form","$","content","spinner","tryagain","modal","questionData","renderCategorySelect","categories","selectHTML","forEach","category","concat","id","name","html","console","log","text","attr","on","renderCategoryInput","getContent","methodname","args","cmid","done","response","hideModal","addClass","setTimeout","removeClass","e","preventDefault","prompt","FormData","this","get","trigger","show","find","prop","questions","JSON","parse","question","options","option","index","correct_answer","empty","showQuestions","hide","fail","error","Error","message","document","length","categoryValue","val","categoryname","status","$this","savingAnimation","append","questionDataJson","Array","isArray","categoryid","remove","successIcon","window","location","href"],"mappings":"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"}
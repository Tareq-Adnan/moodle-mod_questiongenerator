/**
 * TODO describe module questiongenerator
 *
 * @module     mod_questiongenerator/questiongenerator
 * @copyright  2024 YOUR NAME <your@email.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_questiongenerator/questiongenerator",["jquery","core/ajax"],(function($,Ajax){return{init:function(cmid){document.getElementById("quizForm");function attachCheckboxListeners(){const setQuizBtn=document.getElementById("setQuizBtn"),selectAll=document.getElementById("selectAll");function toggleButton(){const checkboxes=document.querySelectorAll('#questionTable input[type="checkbox"]:not(:disabled)');let isChecked=!1;checkboxes.forEach((checkbox=>{checkbox.checked&&(isChecked=!0)})),setQuizBtn&&(setQuizBtn.style.visibility=isChecked?"visible":"hidden")}selectAll&&selectAll.addEventListener("change",(function(){document.querySelectorAll('#questionTable input[type="checkbox"]:not(:disabled)').forEach((checkbox=>{checkbox.checked=selectAll.checked})),toggleButton()})),setQuizBtn&&(setQuizBtn.style.visibility="hidden"),document.querySelector("#questionTable").addEventListener("change",(function(e){e.target&&"checkbox"===e.target.type&&toggleButton()}))}console.log(cmid),$("#setQuizBtn").on("click",(function(){})),$(document).on("submit","#quizForm",(function(event){event.preventDefault();var form=$("#quizForm")[0];if(!form.checkValidity())return event.stopPropagation(),void form.classList.add("was-validated");var quizTitle=$('input[name="quiz_title"]').val(),easyMarks=$('input[name="easy_marks"]').val(),mediumMarks=$('input[name="medium_marks"]').val(),hardMarks=$('input[name="hard_marks"]').val();const selectedQuestions=[];$('#questionTable input[type="checkbox"]:checked').each((function(){"selectAll"!==$(this).attr("id")&&selectedQuestions.push($(this).val())}));var formData={cmid:cmid,quiz_title:quizTitle,easy_marks:easyMarks,medium_marks:mediumMarks,hard_marks:hardMarks,selected_questions:selectedQuestions};console.log(formData),function(formData){var modalBody=document.querySelector(".modal-body");modalBody.innerHTML="<p>Creating quiz...</p>",modalBody.innerHTML+='<div class="spinner-border text-primary" role="status"><span class="sr-only">Loading...</span></div>';var request={methodname:"mod_questiongenerator_create_quiz",args:{quiz_data:JSON.stringify(formData)}},modalFooter=document.querySelector(".modal-footer");modalFooter&&modalFooter.remove(),Ajax.call([request])[0].done((function(response){response.status&&(console.log("Quiz submitted successfully:",response),modalBody.innerHTML="<p>Quiz created successfully!</p>",setTimeout((function(){$("#quizModal").modal("hide")}),2e3))})).fail((function(error){console.error("Error submitting quiz:",error),modalBody.innerHTML='<p class="text-danger">There was an error creating the quiz. Please try again.</p>'}))}(formData)})),$("#categoryDropdown").on("change",(function(){var request={methodname:"mod_questiongenerator_get_generated_questions",args:{categoryid:$(this).val(),cmid:cmid}};Ajax.call([request])[0].done((function(response){var tableBody=$("#questionTable tbody");tableBody.empty(),response.forEach((function(question){console.log(question);var difficultyButton="",selectField="";question.difficulty?(selectField='<input type="checkbox" name="select_question" value="'+question.questionid+'" >',difficultyButton=(difficultyButton=question.difficulty.toLowerCase()).charAt(0).toUpperCase()+difficultyButton.slice(1)):(selectField='<input type="checkbox" name="select_question" value="'+question.questionid+'" disabled="true">',difficultyButton='<button data-question-id="'+question.questionid+'" class="btn btn-primary check-difficulty">Check Difficulty</button>');var row="<tr><td>"+selectField+"</td><td>"+question.question+"</td><td>"+question.options+"</td><td>"+question.answer+"</td><td>"+difficultyButton+"</td></tr>";tableBody.append(row),attachCheckboxListeners()}))})).fail((function(error){console.log("Error fetching questions:",error)}))})),$(document).on("click",".check-difficulty",(function(){var questionId=$(this).data("question-id"),parentTd=$('button[data-question-id="'+questionId+'"]').closest("td");parentTd.html('<div class="spinner-border text-primary" role="status"><span class="sr-only">Loading...</span></div>');var request={methodname:"mod_questiongenerator_check_dificulty_level",args:{questionid:questionId}};console.log("Request:",request),Ajax.call([request])[0].done((function(response){console.log("Response:",response),response?(parentTd.html(response),document.querySelector('input[type="checkbox"][value="'+questionId+'"]').disabled=!1):parentTd.html("Difficulty not found")})).fail((function(error){console.log("Error fetching difficulty level:",error),parentTd.html("Error fetching difficulty level")})),console.log("Question ID:",questionId)})),attachCheckboxListeners(),$(document).ready((function(){$(".state-deactivated, .state-activated").on("click",(function(){const quizId=$(this).data("quiz-id"),isDeactivated=$(this).hasClass("state-deactivated");if(console.log($(".state-activated").length),$(".state-activated").length>0&&isDeactivated)alert("Please deactivate all quizzes first before activating a new one.");else{var request={methodname:"mod_questiongenerator_update_quiz_state",args:{quizid:quizId}};Ajax.call([request])[0].done(function(response){console.log("Response:",response),response?isDeactivated?($(this).removeClass("state-deactivated").addClass("state-activated"),$(this).css("color","red").text("Deactivate")):($(this).removeClass("state-activated").addClass("state-deactivated"),$(this).css("color","").text("Activate")):console.error("Failed to update quiz state.")}.bind(this)).fail((function(error){console.log("Error updating quiz state:",error)}))}}))}))}}}));

//# sourceMappingURL=questiongenerator.min.js.map
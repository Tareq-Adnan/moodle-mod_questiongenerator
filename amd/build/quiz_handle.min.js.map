{"version":3,"file":"quiz_handle.min.js","sources":["../src/quiz_handle.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * TODO describe module quiz_handle\n *\n * @module     mod_questiongenerator/quiz_handle\n * @copyright  2024 YOUR NAME <your@email.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport { call as SubmitForm } from 'core/ajax'\nimport $ from 'jquery';\nexport const quizHandling = async (cmid, quizid, marks) => {\n    let currentTab = 0;\n    var next = document.getElementById(\"nextBtn\");\n    var prev = document.getElementById(\"prevBtn\");\n    var form = document.getElementById(\"quizForm\");\n    showTab(currentTab);\n\n\n    function showTab(n) {\n        let x = document.getElementsByClassName(\"step\");\n        $('#formSpinner').hide();\n        x[n].style.display = \"block\";\n        let progress = (n / (x.length - 1)) * 100;\n        document.querySelector(\".progress-bar\").style.width = progress + \"%\";\n        document.querySelector(\".progress-bar\").setAttribute(\"aria-valuenow\", progress);\n        document.getElementById(\"prevBtn\").style.display = n == 0 ? \"none\" : \"inline\";\n        document.getElementById(\"nextBtn\").innerHTML = n == x.length - 1 ? \"Submit\" : \"Next\";\n        // if (n == x.length) {\n        //     document.getElementById(\"nextBtn\").setAttribute(\"type\", \"submit\");\n        // } else {\n        //     document.getElementById(\"nextBtn\").setAttribute(\"type\", \"button\");\n        // }\n    }\n    next.addEventListener(\"click\", function () {\n        nextPrev(1);\n    });\n    prev.addEventListener(\"click\", function () {\n        nextPrev(-1);\n    });\n\n    function nextPrev(n) {\n        let x = document.getElementsByClassName(\"step\");\n        if (n == 1 && !validateForm()) return false;\n        x[currentTab].style.display = \"none\";\n        currentTab += n;\n        if (currentTab >= x.length) {\n            // document.getElementById(\"quizForm\").submit();\n            document.getElementById(\"nextBtn\").setAttribute(\"type\", \"submit\");\n        } else {\n            showTab(currentTab);\n        }\n\n    }\n\n    $(document).on('submit', '#quizForm', (event) => {\n        event.preventDefault();\n        next.innerHTML = `<span class=\"spinner-border text-light\" role=\"status\" style='height:1.5rem !important; width:1.5rem !important;vertical-align:middle !important'>\n                            </span>`;\n        $('#nextBtn').prop('disabled', true);\n\n\n        let formDataAssocArray = [];\n        $('#quizForm input[type=\"radio\"]:checked').each(function () {\n            const questionId = $(this).attr('name').split('_')[1];\n            const answerIndex = $(this).val();\n            const refValue = $(this).data('ref');\n            const type = $(this).data('type')\n\n            // Push the relevant data to the array\n            formDataAssocArray.push({\n                answer: answerIndex,\n                question: questionId,\n                ref: refValue,\n                type: type.toLowerCase()\n            });\n        });\n\n        SubmitForm([{\n            methodname: 'mod_questiongenerator_attempt_quiz',\n            args: { cmid: cmid, status:'finished' },\n        }])[0].done(response => {\n        }).fail(error => {\n            throw new Error(error.message);\n        });\n\n        SubmitForm([{\n            methodname: 'mod_questiongenerator_end_quiz',\n            args: {\n                quiz_data: formDataAssocArray,\n                cmid: cmid,\n                quizid: parseInt(quizid),\n                marks: marks,\n            },\n        }])[0].done(response => {\n            console.log(response);\n            if (response.status) {\n                $('#quizContainer').html(createThankYouMessage(response.correct_ans, response.wrong, response.total, response.rawmark));\n                setInterval(() => {\n                    $('#redirect-text').append('.');\n                }, 1000);\n\n                setTimeout(function () {\n                    window.location.href = response.redirect;\n                }, 5000);\n            } else {\n                $('#quizContainer').html('<p class=\"text-danger text-center bold\">Something went wrong! Please try again later.</p> <small id=\\'redirect-text\\'></small>');\n                setInterval(() => {\n                    $('#redirect-text').append('.');\n                }, 1000);\n                setTimeout(function () {\n                    window.location.href = response.redirect;\n                }, 5000);\n            }\n        }).fail(error => {\n            console.error('Error:', error.message);\n\n        });\n    })\n\n    function createThankYouMessage(correct, wrong, mark, totalmark) {\n\n        return `\n        <div class=\"success-checkmark\">\n            <div class=\"check-icon\">\n                <span class=\"icon-line line-tip\"></span>\n                <span class=\"icon-line line-long\"></span>\n                <div class=\"icon-circle\"></div>\n                <div class=\"icon-fix\"></div>\n            </div>\n        </div>\n        <div class='text-center'>\n        <h4 style=\"color: #008304;\">Quiz Finished!</h4>\n       <div class=\"alert alert-secondary d-flex justify-content-between align-items-center p-3\">\n    <div class='mx-auto'>\n        <p class=\"mb-1\">\n            <span class='text-success'>You got <strong>${mark}</strong> out of <strong>${totalmark}</strong> marks.</span>\n        </p>\n        <p class=\"mb-1\">\n            <span><strong class=' text-success'>Correct:</strong> ${correct}, <strong class=' text-warning'>Wrong:</strong> ${wrong}</span>\n        </p>\n        <a class='text-center' style='font-weight:400' href='quizresult.php?id=${cmid}&user=0&quiz=${quizid}'> See in Details</a>\n    </div>\n    <div>\n        <i class=\"bi bi-check-circle-fill text-success\" style=\"font-size: 1.5rem;\"></i>\n    </div>\n</div>\n<small id='redirect-text' class=\"text-muted d-block text-center mt-3\">Will be redirecting to course page</small>\n\n    `;\n    }\n\n    function validateForm() {\n        let valid = false;\n        let x = document.getElementsByClassName(\"step\");\n        let y = x[currentTab].getElementsByTagName(\"input\");\n        for (var i = 0; i < y.length; i++) {\n            if (y[i].type === \"radio\" && y[i].checked) {\n                valid = true;\n                break;\n            }\n        }\n        return valid;\n    }\n}"],"names":["async","cmid","quizid","marks","currentTab","next","document","getElementById","prev","showTab","n","x","getElementsByClassName","hide","style","display","progress","length","querySelector","width","setAttribute","innerHTML","nextPrev","valid","y","getElementsByTagName","i","type","checked","validateForm","addEventListener","on","event","preventDefault","prop","formDataAssocArray","each","questionId","this","attr","split","answerIndex","val","refValue","data","push","answer","question","ref","toLowerCase","methodname","args","status","done","response","fail","error","Error","message","quiz_data","parseInt","correct","wrong","mark","totalmark","console","log","html","correct_ans","total","rawmark","setInterval","append","setTimeout","window","location","href","redirect"],"mappings":";;;;;;;wKAwB4BA,MAAOC,KAAMC,OAAQC,aACzCC,WAAa,MACbC,KAAOC,SAASC,eAAe,WAC/BC,KAAOF,SAASC,eAAe,WACxBD,SAASC,eAAe,qBAI1BE,QAAQC,OACTC,EAAIL,SAASM,uBAAuB,4BACtC,gBAAgBC,OAClBF,EAAED,GAAGI,MAAMC,QAAU,YACjBC,SAAYN,GAAKC,EAAEM,OAAS,GAAM,IACtCX,SAASY,cAAc,iBAAiBJ,MAAMK,MAAQH,SAAW,IACjEV,SAASY,cAAc,iBAAiBE,aAAa,gBAAiBJ,UACtEV,SAASC,eAAe,WAAWO,MAAMC,QAAe,GAALL,EAAS,OAAS,SACrEJ,SAASC,eAAe,WAAWc,UAAYX,GAAKC,EAAEM,OAAS,EAAI,SAAW,gBAczEK,SAASZ,OACVC,EAAIL,SAASM,uBAAuB,WAC/B,GAALF,mBA8GAa,OAAQ,EAERC,EADIlB,SAASM,uBAAuB,QAC9BR,YAAYqB,qBAAqB,aACtC,IAAIC,EAAI,EAAGA,EAAIF,EAAEP,OAAQS,OACR,UAAdF,EAAEE,GAAGC,MAAoBH,EAAEE,GAAGE,QAAS,CACvCL,OAAQ,eAITA,MAvHQM,GAAgB,OAAO,EACtClB,EAAEP,YAAYU,MAAMC,QAAU,OAC9BX,YAAcM,EACVN,YAAcO,EAAEM,OAEhBX,SAASC,eAAe,WAAWa,aAAa,OAAQ,UAExDX,QAAQL,YAlChBK,QAAQL,YAkBRC,KAAKyB,iBAAiB,SAAS,WAC3BR,SAAS,MAEbd,KAAKsB,iBAAiB,SAAS,WAC3BR,UAAU,0BAiBZhB,UAAUyB,GAAG,SAAU,aAAcC,QACnCA,MAAMC,iBACN5B,KAAKgB,UAAa,+MAEhB,YAAYa,KAAK,YAAY,OAG3BC,mBAAqB,uBACvB,yCAAyCC,MAAK,iBACtCC,YAAa,mBAAEC,MAAMC,KAAK,QAAQC,MAAM,KAAK,GAC7CC,aAAc,mBAAEH,MAAMI,MACtBC,UAAW,mBAAEL,MAAMM,KAAK,OACxBjB,MAAO,mBAAEW,MAAMM,KAAK,QAG1BT,mBAAmBU,KAAK,CACpBC,OAAQL,YACRM,SAAUV,WACVW,IAAKL,SACLhB,KAAMA,KAAKsB,kCAIR,CAAC,CACRC,WAAY,qCACZC,KAAM,CAAElD,KAAMA,KAAMmD,OAAO,eAC3B,GAAGC,MAAKC,eACTC,MAAKC,cACE,IAAIC,MAAMD,MAAME,2BAGf,CAAC,CACRR,WAAY,iCACZC,KAAM,CACFQ,UAAWxB,mBACXlC,KAAMA,KACNC,OAAQ0D,SAAS1D,QACjBC,MAAOA,UAEX,GAAGkD,MAAKC,eA0BeO,QAASC,MAAOC,KAAMC,UAzB7CC,QAAQC,IAAIZ,UACRA,SAASF,4BACP,kBAAkBe,MAuBDN,QAvB4BP,SAASc,YAuB5BN,MAvByCR,SAASQ,MAuB3CC,KAvBkDT,SAASe,MAuBrDL,UAvB4DV,SAASgB,QAyB9G,snBAcyCP,gCAAgCC,+IAGrBH,0DAA0DC,8GAE7C7D,oBAAoBC,8RA3CrFqE,aAAY,yBACN,kBAAkBC,OAAO,OAC5B,KAEHC,YAAW,WACPC,OAAOC,SAASC,KAAOtB,SAASuB,WACjC,2BAED,kBAAkBV,KAAK,kIACzBI,aAAY,yBACN,kBAAkBC,OAAO,OAC5B,KACHC,YAAW,WACPC,OAAOC,SAASC,KAAOtB,SAASuB,WACjC,SAERtB,MAAKC,QACJS,QAAQT,MAAM,SAAUA,MAAME"}